#! /bin/sh
set -e

export CDIMAGE_ROOT=/srv/cdimage.no-name-yet.com
. "$CDIMAGE_ROOT/etc/config"

if [ -z "$1" ] || [ -z "$2" ]; then
	echo 'Usage: find-live-filesystem ARCH cloop|manifest|winfoss' >&2
	exit 1
fi
ARCH="$1"
ITEM="$2"

case $ARCH in
	amd64)
		LIVECD=http://king.buildd/~buildd/livecd
		;;
	hppa)
		LIVECD=/home/cjwatson/hppa-livecd
		;;
	i386)
		LIVECD=http://terranova.buildd/~buildd/livecd
		;;
	ia64)
		LIVECD=http://weddell.buildd/~buildd/livecd
		;;
	powerpc)
		LIVECD=http://royal.buildd/~buildd/livecd
		;;
	*)
		echo "No live filesystem source known for $ARCH" >&2
		exit 1
		;;
esac

case $PROJECT in
	livecd-base)
		LIVEPROJECT=base
		;;
	tocd3.1)
		LIVEPROJECT=tocd
		;;
	*)
		LIVEPROJECT="$PROJECT"
		;;
esac

case $ITEM in
	cloop)
		case $PROJECT in
			tocd3)
				# cloop got auto-purged - reverting to plan B
				echo /home/cjwatson/tocd3/livecd.tocd3.cloop
				;;
			tocd3.1)
				# cloop got auto-purged - reverting to plan B
				echo /home/cjwatson/tocd3.1/livecd.tocd3.1.cloop
				;;
			ubuntu)
				case $DIST in
					breezy)
						# cloop got auto-purged - reverting to plan B
						echo "/home/cjwatson/breezy-live/ubuntu/livecd.$ARCH.cloop"
						;;
					*)
						echo "$LIVECD/$LIVEPROJECT/current/livecd.$LIVEPROJECT.cloop"
						;;
				esac
				;;
			*)
				echo "$LIVECD/$LIVEPROJECT/current/livecd.$LIVEPROJECT.cloop"
				;;
		esac
		;;
	manifest)
		case $PROJECT in
			tocd3)
				# manifest got auto-purged - reverting to plan B
				echo /home/cjwatson/tocd3/livecd.tocd3.manifest
				;;
			tocd3.1)
				# manifest got auto-purged - reverting to plan B
				echo /home/cjwatson/tocd3.1/livecd.tocd3.1.manifest
				;;
			ubuntu)
				case $DIST in
					breezy)
						# manifest got auto-purged - reverting to plan B
						echo "/home/cjwatson/breezy-live/ubuntu/livecd.$ARCH.manifest"
						;;
					*)
						echo "$LIVECD/$LIVEPROJECT/current/livecd.$LIVEPROJECT.manifest"
						;;
				esac
				;;
			*)
				echo "$LIVECD/$LIVEPROJECT/current/livecd.$LIVEPROJECT.manifest"
				;;
		esac
		;;
	winfoss)
		if [ "$DIST" = warty ]; then
			exit 1
		fi
		case $PROJECT in
			ubuntu)
				case $DIST in
					hoary)
						case $ARCH in
							i386)
								echo http://maitri.ubuntu.com/theopencd/ubuntu/winfoss/latest/Hoary-WinFOSS.tgz
								;;
							amd64)
								echo http://maitri.ubuntu.com/theopencd/ubuntu/amd64/latest/Hoary-WinFOSS-amd64.tgz
								;;
							*)	exit 1 ;;
						esac
						;;
					breezy|dapper)
						case $ARCH in
							i386|amd64)
								echo http://www.theopencd.org/winfoss/ubuntu/current/Ubuntu-WinFOSS-5.10.tgz
								;;
							*)	exit 1 ;;
						esac
						;;
				esac
				;;
			kubuntu)
				case $DIST in
					hoary)
						case $ARCH in
							i386)
								echo http://maitri.ubuntu.com/theopencd/kubuntu/winfoss/latest/Kubuntu-WinFOSS-i386.tgz
								;;
							*)	exit 1 ;;
						esac
						;;
					breezy|dapper)
						case $ARCH in
							i386)
								echo http://www.theopencd.org/winfoss/kubuntu/current/Kubuntu-WinFOSS-5.10.tgz
								;;
							amd64)
								echo http://www.theopencd.org/winfoss/kubuntu-AMD/current/Kubuntu-WinFOSS-5.10-AMD.tgz
								;;
							*)	exit 1 ;;
						esac
						;;
				esac
				;;
			tocd3)
				case $ARCH in
					i386)
						echo http://maitri.ubuntu.com/theopencd/tocd3/fsm/TOCD3.tgz
						;;
					*)	exit 1 ;;
				esac
				;;
			tocd3.1)
				case $ARCH in
					i386)
						echo http://www.theopencd.org/winfoss/tocd3.1/current/TOCD-31.tgz
						;;
					*)	exit 1 ;;
				esac
				;;
			*)	exit 1 ;;
		esac
		;;
	*)
		echo "Unknown live filesystem item '$ITEM'" >&2
		exit 1
		;;
esac

exit 0
